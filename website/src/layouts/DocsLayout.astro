---
import '@/styles/global.css';
import { ViewTransitions } from 'astro:transitions';
import Navbar from '@/components/Navbar.astro';
import Footer from '@/components/Footer.astro';
import Sidebar from '@/components/Sidebar.astro';
import TableOfContents from '@/components/TableOfContents.astro';

interface Props {
  title: string;
  description?: string;
  sourceFile?: string;
  headings?: Array<{
    depth: number;
    slug: string;
    text: string;
  }>;
}

const {
  title,
  description = 'The fast, flexible & elegant library for parsing and manipulating HTML and XML.',
  sourceFile,
  headings = [],
} = Astro.props;

const editUrl = sourceFile
  ? `https://github.com/cheeriojs/cheerio/edit/main/website/src/content/docs/${sourceFile}`
  : null;

const currentPath = Astro.url.pathname;

// Flat ordered list of all doc pages for prev/next navigation
const allPages = [
  { label: 'Introduction', href: '/docs/intro' },
  { label: 'Loading Documents', href: '/docs/basics/loading' },
  { label: 'Selecting Elements', href: '/docs/basics/selecting' },
  { label: 'Traversing the DOM', href: '/docs/basics/traversing' },
  { label: 'Manipulating Elements', href: '/docs/basics/manipulation' },
  { label: 'Configuring Cheerio', href: '/docs/advanced/configuring-cheerio' },
  { label: 'Extending Cheerio', href: '/docs/advanced/extending-cheerio' },
  { label: 'Extracting Data', href: '/docs/advanced/extract' },
  { label: 'API Documentation', href: '/docs/api' },
];

const currentIndex = allPages.findIndex((p) => p.href === currentPath.replace(/\/$/, ''));
const prevPage = currentIndex > 0 ? allPages[currentIndex - 1] : null;
const nextPage = currentIndex >= 0 && currentIndex < allPages.length - 1 ? allPages[currentIndex + 1] : null;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="htmlparser, jquery, selector, scraper, parser, dom, xml, html, nodejs"
    />
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <title>{title} | Cheerio</title>
    <ViewTransitions />
  </head>
  <body
    class="flex min-h-screen flex-col bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100"
  >
    <Navbar />
    <div class="mx-auto flex w-full max-w-screen-2xl flex-1">
      <Sidebar currentPath={currentPath} />
      <main class="flex-1 min-w-0 px-6 py-10 lg:px-10">
        {/* Mobile sidebar trigger */}
        <button
          type="button"
          id="sidebar-open"
          class="mb-6 inline-flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 lg:hidden dark:border-slate-700 dark:text-slate-400 dark:hover:bg-slate-800"
          aria-label="Open navigation"
        >
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
          Menu
        </button>

        {/* Editorial header */}
        <header class="mb-8 border-b border-slate-200 pb-6 dark:border-slate-700/50">
          <h1 class="font-display text-3xl text-slate-900 lg:text-4xl dark:text-white">{title}</h1>
        </header>

        <article class="prose docs-content">
          <slot />
        </article>

        {/* Edit on GitHub */}
        {editUrl && (
          <div class="mt-10 pt-5">
            <a
              href={editUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1.5 text-sm text-slate-400 transition-colors hover:text-primary dark:text-slate-500 dark:hover:text-primary"
            >
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
              </svg>
              Edit this page on GitHub
            </a>
          </div>
        )}

        {/* Prev/Next navigation */}
        {(prevPage || nextPage) && (
          <nav class="mt-12 flex items-stretch gap-4 border-t border-slate-200 pt-6 dark:border-slate-700/50" aria-label="Page navigation">
            {prevPage ? (
              <a
                href={prevPage.href}
                class="group flex flex-1 flex-col items-start rounded-xl border border-slate-200 px-5 py-4 transition-all hover:border-primary/40 hover:shadow-sm dark:border-slate-700 dark:hover:border-primary/40"
              >
                <span class="mb-1 text-xs font-medium uppercase tracking-wider text-slate-400 dark:text-slate-500">Previous</span>
                <span class="flex items-center gap-1.5 text-sm font-semibold text-slate-700 transition-colors group-hover:text-primary dark:text-slate-200 dark:group-hover:text-primary">
                  <svg class="h-3.5 w-3.5 transition-transform group-hover:-translate-x-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                  </svg>
                  {prevPage.label}
                </span>
              </a>
            ) : <div class="flex-1" />}
            {nextPage ? (
              <a
                href={nextPage.href}
                class="group flex flex-1 flex-col items-end rounded-xl border border-slate-200 px-5 py-4 transition-all hover:border-primary/40 hover:shadow-sm dark:border-slate-700 dark:hover:border-primary/40"
              >
                <span class="mb-1 text-xs font-medium uppercase tracking-wider text-slate-400 dark:text-slate-500">Next</span>
                <span class="flex items-center gap-1.5 text-sm font-semibold text-slate-700 transition-colors group-hover:text-primary dark:text-slate-200 dark:group-hover:text-primary">
                  {nextPage.label}
                  <svg class="h-3.5 w-3.5 transition-transform group-hover:translate-x-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                  </svg>
                </span>
              </a>
            ) : <div class="flex-1" />}
          </nav>
        )}
      </main>
      <TableOfContents headings={headings} />
    </div>
    <Footer />
  </body>
</html>
